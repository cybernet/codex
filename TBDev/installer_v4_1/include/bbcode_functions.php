<?php
$smilies = array(
  ":-)" => "smile1.gif",
  ":smile:" => "smile2.gif",
  ":-D" => "grin.gif",
  ":lol:" => "laugh.gif",
  ":w00t:" => "w00t.gif",
  ":-P" => "tongue.gif",
  ";-)" => "wink.gif",
  ":-|" => "noexpression.gif",
  ":-/" => "confused.gif",
  ":-(" => "sad.gif",
  ":'-(" => "cry.gif",
  ":weep:" => "weep.gif",
  ":-O" => "ohmy.gif",
  ":o)" => "clown.gif",
  "8-)" => "cool1.gif",
  "|-)" => "sleeping.gif",
  ":innocent:" => "innocent.gif",
  ":whistle:" => "whistle.gif",
  ":unsure:" => "unsure.gif",
  ":closedeyes:" => "closedeyes.gif",
  ":cool:" => "cool2.gif",
  ":fun:" => "fun.gif",
  ":thumbsup:" => "thumbsup.gif",
  ":thumbsdown:" => "thumbsdown.gif",
  ":blush:" => "blush.gif",
  ":unsure:" => "unsure.gif",
  ":yes:" => "yes.gif",
  ":no:" => "no.gif",
  ":love:" => "love.gif",
  ":?:" => "question.gif",
  ":!:" => "excl.gif",
  ":idea:" => "idea.gif",
  ":arrow:" => "arrow.gif",
  ":arrow2:" => "arrow2.gif",
  ":hmm:" => "hmm.gif",
  ":hmmm:" => "hmmm.gif",
  ":huh:" => "huh.gif",
  ":geek:" => "geek.gif",
  ":look:" => "look.gif",
  ":rolleyes:" => "rolleyes.gif",
  ":kiss:" => "kiss.gif",
  ":shifty:" => "shifty.gif",
  ":blink:" => "blink.gif",
  ":smartass:" => "smartass.gif",
  ":sick:" => "sick.gif",
  ":crazy:" => "crazy.gif",
  ":wacko:" => "wacko.gif",
  ":alien:" => "alien.gif",
  ":wizard:" => "wizard.gif",
  ":wave:" => "wave.gif",
  ":wavecry:" => "wavecry.gif",
  ":baby:" => "baby.gif",
  ":angry:" => "angry.gif",
  ":ras:" => "ras.gif",
  ":sly:" => "sly.gif",
  ":devil:" => "devil.gif",
  ":evil:" => "evil.gif",
  ":evilmad:" => "evilmad.gif",
  ":sneaky:" => "sneaky.gif",
  ":axe:" => "axe.gif",
  ":slap:" => "slap.gif",
  ":wall:" => "wall.gif",
  ":rant:" => "rant.gif",
  ":jump:" => "jump.gif",
  ":yucky:" => "yucky.gif",
  ":nugget:" => "nugget.gif",
  ":smart:" => "smart.gif",
  ":shutup:" => "shutup.gif",
  ":shutup2:" => "shutup2.gif",
  ":crockett:" => "crockett.gif",
  ":zorro:" => "zorro.gif",
  ":snap:" => "snap.gif",
  ":beer:" => "beer.gif",
  ":beer2:" => "beer2.gif",
  ":drunk:" => "drunk.gif",
  ":strongbench:" => "strongbench.gif",
  ":weakbench:" => "weakbench.gif",
  ":dumbells:" => "dumbells.gif",
  ":music:" => "music.gif",
  ":stupid:" => "stupid.gif",
  ":dots:" => "dots.gif",
  ":offtopic:" => "offtopic.gif",
  ":spam:" => "spam.gif",
  ":oops:" => "oops.gif",
  ":lttd:" => "lttd.gif",
  ":please:" => "please.gif",
  ":sorry:" => "sorry.gif",
  ":hi:" => "hi.gif",
  ":yay:" => "yay.gif",
  ":cake:" => "cake.gif",
  ":hbd:" => "hbd.gif",
  ":band:" => "band.gif",
  ":punk:" => "punk.gif",
	":rofl:" => "rofl.gif",
  ":bounce:" => "bounce.gif",
  ":mbounce:" => "mbounce.gif",
  ":thankyou:" => "thankyou.gif",
  ":gathering:" => "gathering.gif",
  ":hang:" => "hang.gif",
  ":chop:" => "chop.gif",
  ":rip:" => "rip.gif",
  ":whip:" => "whip.gif",
  ":judge:" => "judge.gif",
  ":chair:" => "chair.gif",
  ":tease:" => "tease.gif",
  ":box:" => "box.gif",
  ":boxing:" => "boxing.gif",
  ":guns:" => "guns.gif",
  ":shoot:" => "shoot.gif",
  ":shoot2:" => "shoot2.gif",
  ":flowers:" => "flowers.gif",
  ":wub:" => "wub.gif",
  ":lovers:" => "lovers.gif",
  ":kissing:" => "kissing.gif",
  ":kissing2:" => "kissing2.gif",
  ":console:" => "console.gif",
  ":group:" => "group.gif",
  ":hump:" => "hump.gif",
  ":hooray:" => "hooray.gif",
  ":happy2:" => "happy2.gif",
  ":clap:" => "clap.gif",
  ":clap2:" => "clap2.gif",
	":weirdo:" => "weirdo.gif",
  ":yawn:" => "yawn.gif",
  ":bow:" => "bow.gif",
	":dawgie:" => "dawgie.gif",
	":cylon:" => "cylon.gif",
  ":book:" => "book.gif",
  ":fish:" => "fish.gif",
  ":mama:" => "mama.gif",
  ":pepsi:" => "pepsi.gif",
  ":medieval:" => "medieval.gif",
  ":rambo:" => "rambo.gif",
  ":ninja:" => "ninja.gif",
  ":hannibal:" => "hannibal.gif",
  ":party:" => "party.gif",
  ":snorkle:" => "snorkle.gif",
  ":evo:" => "evo.gif",
  ":king:" => "king.gif",
  ":chef:" => "chef.gif",
  ":mario:" => "mario.gif",
  ":pope:" => "pope.gif",
  ":fez:" => "fez.gif",
  ":cap:" => "cap.gif",
  ":cowboy:" => "cowboy.gif",
  ":pirate:" => "pirate.gif",
  ":pirate2:" => "pirate2.gif",
  ":rock:" => "rock.gif",
  ":cigar:" => "cigar.gif",
  ":icecream:" => "icecream.gif",
  ":oldtimer:" => "oldtimer.gif",
	":trampoline:" => "trampoline.gif",
	":banana:" => "bananadance.gif",
  ":smurf:" => "smurf.gif",
  ":yikes:" => "yikes.gif",
  ":osama:" => "osama.gif",
  ":saddam:" => "saddam.gif",
  ":santa:" => "santa.gif",
  ":indian:" => "indian.gif",
  ":pimp:" => "pimp.gif",
  ":nuke:" => "nuke.gif",
  ":jacko:" => "jacko.gif",
  ":ike:" => "ike.gif",
  ":greedy:" => "greedy.gif",
	":super:" => "super.gif",
  ":wolverine:" => "wolverine.gif",
  ":spidey:" => "spidey.gif",
  ":spider:" => "spider.gif",
  ":bandana:" => "bandana.gif",
  ":construction:" => "construction.gif",
  ":sheep:" => "sheep.gif",
  ":police:" => "police.gif",
	":detective:" => "detective.gif",
  ":bike:" => "bike.gif",
	":fishing:" => "fishing.gif",
  ":clover:" => "clover.gif",
  ":horse:" => "horse.gif",
  ":shit:" => "shit.gif",
  ":soldiers:" => "soldiers.gif",
  ":blum:" => "blum.gif",
  ":congrat:" => "clapping2.gif",
  ":thedevil:" => "diablo.gif",
  ":drinks2:" => "drinks2.gif",
  ":rose:" => "give_rose.gif",
  ":good:" => "good.gif",
  ":hi2:" => "hi2.gif",
  ":pardon:" => "pardon.gif",
  ":rofl2:" => "rofl2.gif",
  ":spite:" => "spiteful.gif",
  ":unsure:" => "unknw.gif",
  ":cuppa:" => "cuppa.gif",
  ":smoken:" => "smoke2.gif",
  ":slick:" => "uber.gif",
  ":sun:" => "read.gif",
);



$privatesmilies = array(
  ":)" => "smile1.gif",
//  ";)" => "wink.gif",
  ":wink:" => "wink.gif",
  ":D" => "grin.gif",
  ":P" => "tongue.gif",
  ":(" => "sad.gif",
  ":'(" => "cry.gif",
  ":|" => "noexpression.gif",
  // "8)" => "cool1.gif",   we don't want this as a smilie...
  ":Boozer:" => "alcoholic.gif",
  ":deadhorse:" => "deadhorse.gif",
  ":spank:" => "spank.gif",
  ":yoji:" => "yoji.gif",
  ":locked:" => "locked.gif",
  ":grrr:" => "angry.gif", 			// legacy
  "O:-" => "innocent.gif",			// legacy
  ":sleeping:" => "sleeping.gif",	// legacy
  "-_-" => "unsure.gif",			// legacy
  ":clown:" => "clown.gif",
  ":mml:" => "mml.gif",
  ":rtf:" => "rtf.gif",
  ":morepics:" => "morepics.gif",
  ":rb:" => "rb.gif",
  ":rblocked:" => "rblocked.gif",
  ":maxlocked:" => "maxlocked.gif",
  ":hslocked:" => "hslocked.gif",
  ":grey:" => "grey.gif",
  ); 

$customsmilies = array(  
   ":fart:" => "fart.gif",
  ":fart2:" => "fart2.gif",
  ":lurker:" => "lurker.gif",
  ":blow:" => "badrazz.gif",
  ":jawdrop:" => "jawdrop.gif",
  ":sob:" => "sob.gif",
  ":whip2:" => "whip2.gif",
  ":geek2:" => "geek2.gif",
  ":madgrin:" => "mad-grin.gif",
  ":byebye:" => "connie_mini_byebye.gif",
  ":badrazz:" => "badrazz.gif",
  ":img:" => "img.gif",
  ":alcohol:" => "alcohol.gif",
  ":pmsl:" => "hysterical.gif",
  ":bombie:" => "bomb_ie.gif",
  ":whoops:" => "whoops.gif",
  ":banned:" => "banned.gif",
  ":faq:" => "faq.gif",
  ":iluvff:" => "iluvff.gif",
  ":starwars:" => "starwars.gif",
  ":mage:" => "mage.gif",
  ":respect:" => "respect.gif",
  ":utorrent:" => "utorrent.gif",
  ":spliffy:" => "spliffy.gif",
  ":bear:" => "bear.gif",
  ":bandit:" => "bandit.gif",
  ":congrats:" => "congrats.gif",
  ":smokin:" => "smokin.gif",
  ":canabis:" => "canabis.gif",
  ":2gun:" => "2gun.gif",
  ":bigun:" => "biggun.gif",
  ":chainsaw:" => "chainsaw2.gif",
  ":drinks:" => "drinks.gif",
  ":fight1:" => "fight1.gif",
  ":fight2:" => "fight2.gif",
  ":fight3:" => "fight3.gif",
  ":fight4:" => "fight4.gif",
  ":first:" => "first.gif",
  ":fight1:" => "fight1.gif",
  ":Gotcha:" => "Gotcha.gif",
  ":jumping:" => "jumping.gif",
  ":yoda:" => "yoda.gif",
  ":wink1:" => "wink1.gif",
  ":upyours:" => "upyours.gif",
  ":taz:" => "taz.gif",
  ":spew2:" => "spew2.gif",
  ":spew:" => "spew.gif",
  ":sniper1:" => "sniper1.gif",
  ":smokie2:" => "smokie2.gif",
  ":sick2:" => "sick2.gif",
  ":scream:" => "scream.gif",
  ":rasp2:" => "rasp2.gif",
  ":rasp:" => "rasp.gif",
  ":party8:" => "party8.gif",
  ":party7:" => "party7.gif", 
  ":party6:" => "party6.gif",
  ":party5:" => "party5.gif",
  ":party4:" => "party4.gif",
  ":party3:" => "party3.gif",
  ":party2:" => "party2.gif",
  ":party1:" => "party1.gif",
  ":oldman:" => "oldman.gif",
  ":ninja2:" => "ninja2.gif",
  ":madaRse:" => "madarse.gif",
  ":line:" => "Line.gif",
  ":last:" => "last.gif",
  ":kenny:" => "kenny.gif",
  ":jumping3:" => "jumping3.gif",
  ":jumping2:" => "jumping2.gif",
  ":jumping1:" => "jumping1.gif",
  ":pish:" => "pish.gif",
  ":grim:" => "grim.gif",
  ":taz2:" => "taz2.gif",
  ":spiderman:" => "spidey.gif",
  ":bong:" => "bong.gif",
  ":eye:" => "eye.gif",
  ":tumble:" => "tumbleweed.gif",
  ":welcome:" => "welcome.gif",
  ":fart3:" => "fart3.gif",
  ":caveman:" => "caveman.gif",
  ":explode:" => "explode.gif",
  ":finger:" => "finger.gif",
  ":bhong:" => "bhong.gif",
  ":bye:" => "bye.gif",
  ":slip:" => "slip.gif",
  ":jerry:" => "jerry.gif",
  ":schair:" => "schair.gif",
  ":raver:" => "raver.gif",
  ":ras2:" => "ras2.gif",
  ":moonie:" => "moonie.gif",
  ":hides:" => "hides.gif",
  ":apache:" => "apache.gif",
  ":doobie:" => "doobie.gif",
  ":acid:" => "acid.gif",
  ":angeldevil:" => "angeldevil.gif",
  ":madraver:" => "madraver.gif",
  ":clapper1:" => "clapper1.gif",
  ":high5:" => "high5.gif",
  ":shoutkiller:" => "shoutkiller.gif",
  ":wanker:" => "wank.gif",
  ":homer:" => "homer.gif",
  ":riding:" => "bedhump.gif",
  );

require_once ROOT_PATH."include/geshi/geshi.php";     
function source_highlighter($code)
	{
	
		$source = str_replace(array("&gt;", "&lt;", "&quot;", "&amp;"), array(">", "<", "\"", "&"), $code[1]);
		
		if(false!==stristr($code[0],"[php]"))
			$lang2geshi = "php";
		elseif (false!==stristr($code[0],"[sql]"))
			$lang2geshi = "sql";
		elseif (false!==stristr($code[0],"[html]"))
			$lang2geshi = "html4strict";
		else
			$lang2geshi = "txt";
			
		$geshi = new GeSHi($source,$lang2geshi);
		$geshi->set_header_type(GESHI_HEADER_PRE_VALID);
		$geshi->set_overall_style('font: normal normal 100% monospace; color: #000066;', false);
        $geshi->set_line_style('color: #003030;', 'font-weight: bold; color: #006060;', true);
		$geshi->set_code_style('color: #000020;font-family:monospace; font-size:12px;line-height:6px;', true);
		//$geshi->enable_line_numbers(GESHI_NORMAL_LINE_NUMBERS);
		$geshi->enable_classes(false);
		$geshi->set_link_styles(GESHI_LINK, 'color: #000060;');
		$geshi->set_link_styles(GESHI_HOVER, 'background-color: #f0f000;');
		$return = "<div class=\"codetop\">CODE</div><div class=\"codemain\">\n";
		$return .= $geshi->parse_code();
		$return .= "\n</div>\n";
			return  $return;
	
	}
        
        // Finds last occurrence of needle in haystack
        // in PHP5 use strripos() instead of this
        function _strlastpos ($haystack, $needle, $offset = 0)
        {
            $addLen = strlen ($needle);
            $endPos = $offset - $addLen;
            while (true) {
                if (($newPos = strpos ($haystack, $needle, $endPos + $addLen)) === false) break;
                $endPos = $newPos;
            }
            return ($endPos >= 0) ? $endPos : false;
        }
        function islocal($link)
        {
            $flag = false;
            $baseurl = "127.0.0.1";
            $limit = 60;

            if (false !== stristr($link[0], '[url=')) {
                $url = trim($link[1]);
                $title = trim($link[2]);
                if (false !== stristr($link[2], '[img]')) {
                    $flag = true;
                    $title = preg_replace("/\[img](http:\/\/[^\s'\"<>]+(\.(jpg|gif|png)))\[\/img\]/i", "<img src=\"\\1\" alt=\"\" border=\"0\" />", $title);
                }
            } elseif (false !== stristr($link[0], '[url]'))
                $url = $title = trim($link[1]);
            else
                $url = $title = trim($link[2]);

            if (strlen($title) > $limit && $flag == false) {
                $l[0] = substr($title, 0, ($limit / 2));
                $l[1] = substr($title, strlen($title) - round($limit / 3));
                $lshort = $l[0] . "..." . $l[1];
            } else $lshort = $title;
            return "&nbsp;<a href=\"" . ((stristr($url, $baseurl) !== false) ? "" : "http://anonym.to?") . $url . "\" target=\"_blank\">" . $lshort . "</a>";
        }

        function format_urls($s)
        {
            return preg_replace_callback("/(\A|[^=\]'\"a-zA-Z0-9])((http|ftp|https|ftps|irc):\/\/[^<>\s]+)/i", "islocal", $s);
        }
        function format_quotes($s)
        {
            preg_match_all('/\\[quote.*?\\]/', $s, $result, PREG_PATTERN_ORDER);
            $openquotecount = count($openquote = $result[0]);
            preg_match_all('/\\[\/quote\\]/', $s, $result, PREG_PATTERN_ORDER);
            $closequotecount = count($closequote = $result[0]);

            if ($openquotecount != $closequotecount) return $s; // quote mismatch. Return raw string...

            // Get position of opening quotes
            $openval = array();
            $pos = -1;

            foreach($openquote as $val)
            $openval[] = $pos = strpos($s, $val, $pos + 1);
            // Get position of closing quotes
            $closeval = array();
            $pos = -1;

            foreach($closequote as $val)
            $closeval[] = $pos = strpos($s, $val, $pos + 1);

            for ($i = 0; $i < count($openval); $i++)
            if ($openval[$i] > $closeval[$i]) return $s; // Cannot close before opening. Return raw string...

            $s = str_replace("[quote]", "<p class=sub><b>Quote:</b></p><table class=main border=1 cellspacing=0 cellpadding=10><tr><td style='border: 1px black dotted'>", $s);
            $s = preg_replace("/\\[quote=(.+?)\\]/", "<p class=sub><b>\\1 wrote:</b></p><table class=main border=1 cellspacing=0 cellpadding=10><tr><td style='border: 1px black dotted'>", $s);
            $s = str_replace("[/quote]", "</td></tr></table><br>", $s);
            return $s;
        }
        function scale($src)
        {
            $max = 350;
            if (!isset($max, $src))
                return;

            $src = str_replace(" ", "%20", $src[1]);

            $info = @getimagesize($src);

            $sw = $info[0];
            $sh = $info[1];

            $addclass = false;
            $max_em = 0.06 * $max;
            if ($max < max($sw, $sh)) {
                if ($sw > $sh)
                    $new = array($max_em . "em", "auto");
                if ($sw < $sh)
                    $new = array("auto", $max_em . "em");
                $addclass = true;
            } else
                $new = array("auto", "auto");
            $id = mt_rand(0000, 9999);

            if ($new[0] == "auto" && $new[1] == "auto")
                $img = "<img src=\"" . $src . "\" border=\"0\" />";
            else
                $img = "<a href=\"" . $src . "\"  onclick=\"return false;\" target=\"_blank\"><img id=\"r" . $id . "\" border=\"0\" src=\"" . $src . "\" " . ($addclass ? "class=\"resized\"" : "") . " style=\"width:" . $new[0] . ";height:" . $new[1] . ";\" /></a>";
            return $img;
        }
           function format_comment($text, $strip_html = true)
           {
            global $smilies, $privatesmilies, $pic_base_url, $customsmilies, $CURUSER, $badwords, $DEFAULTBASEURL;

            $s = $text;
            // This fixes the extraneous ;) smilies problem. When there was an html escaped
            // char before a closing bracket - like >), "), ... - this would be encoded
            // to &xxx;), hence all the extra smilies. I created a new :wink: label, removed
            // the ;) one, and replace all genuine ;) by :wink: before escaping the body.
            // (What took us so long? :blush:)- wyz
            $s = str_replace(";)", ":wink:", $s);
			      if ($strip_html)
            $s = htmlspecialchars($s);				
			      // [php]php code[/php]
            $s = preg_replace_callback( "/\[php\]((\s|.)+?)\[\/php\]/ims", "source_highlighter", $s );
            // [sql]sql code[/sql]
            $s = preg_replace_callback( "/\[sql\]((\s|.)+?)\[\/sql\]/ims", "source_highlighter", $s );
			      // [html]html code[/html]
			      $s = preg_replace_callback( "/\[html\]((\s|.)+?)\[\/html\]/ims", "source_highlighter", $s );          
            // format urls
            $s = format_urls($s);
            // [url=http://www.example.com]Text[/url]
            $s = preg_replace_callback("/\[url=([^()<>\s]+?)\]((\s|.)+?)\[\/url\]/i", "islocal", $s);
            // [url]http://www.example.com[/url]
            $s = preg_replace_callback("/\[url\]([^()<>\s]+?)\[\/url\]/i", "islocal", $s);
            // [*]
            $s = preg_replace("/\[\*\]/", "<li>", $s);
            // [b]Bold[/b]
            $s = preg_replace("/\[b\]((\s|.)+?)\[\/b\]/", "<b>\\1</b>", $s);
            // [i]Italic[/i]
            $s = preg_replace("/\[i\]((\s|.)+?)\[\/i\]/", "<i>\\1</i>", $s);
            // [u]Underline[/u]
            $s = preg_replace("/\[u\]((\s|.)+?)\[\/u\]/", "<u>\\1</u>", $s);
            // [u]Underline[/u]
            // the [you] tag
            $s = preg_replace("/\[you\]/i", $CURUSER['username'], $s);
            // Dynamic Vars
            $s = dynamic_user_vars($s);
            $s = preg_replace("/\[u\]((\s|.)+?)\[\/u\]/i", "<u>\\1</u>", $s);
            // YouTube Vids
            $s = preg_replace("/\[video=[^\s'\"<>]*youtube.com.*v=([^\s'\"<>]+)\]/ims", "<object width=\"500\" height=\"410\"><param name=\"movie\" value=\"http://www.youtube.com/v/\\1\"></param><embed src=\"http://www.youtube.com/v/\\1\" type=\"application/x-shockwave-flash\" width=\"500\" height=\"410\"></embed></object>", $s);
            // Google Vids
            $s = preg_replace("/\[video=[^\s'\"<>]*video.google.com.*docid=(-?[0-9]+).*\]/ims", "<embed style=\"width:500px; height:410px;\" id=\"VideoPlayback\" align=\"middle\" type=\"application/x-shockwave-flash\" src=\"http://video.google.com/googleplayer.swf?docId=\\1\" allowScriptAccess=\"sameDomain\" quality=\"best\" bgcolor=\"#ffffff\" scale=\"noScale\" wmode=\"window\" salign=\"TL\"  FlashVars=\"playerMode=embedded\"> </embed>", $s);
            // [highlight]Highlight text[/highlight]
            $s = preg_replace("/\[highlight\]((\s|.)+?)\[\/highlight\]/", "<table border=0 cellspacing=0 cellpadding=1>" . "<tr><td bgcolor=green><b>\\1</b></td></tr>" . "</table>", $s);           
            // [marquee]Marquee[/marquee]
            $s = preg_replace("/\[marquee\]((\s|.)+?)\[\/marquee\]/", "<marquee>\\1</marquee>", $s);
            // [blink]blink[/blink]
            $s = preg_replace("/\[blink\]((\s|.)+?)\[\/blink\]/", "<blink>\\1</blink>", $s);
            // [mcom]Text[/mcom]
            $s = preg_replace("/\[mcom\]\s*((\s|.)+?)\s*\[\/mcom\]\s*/i",
                "<span style=\"font-size: 18pt; line-height: 50%;\">
   <div style=\"border-color: red; background-color: red; color: white; text-align: center; font-weight: bold; font-size: large;\">
   <b>\\1</b>
   </div>
   </span>", $s);
            // [color=blue]Text[/color]
            $s = preg_replace("/\[color=([a-zA-Z]+)\]((\s|.)+?)\[\/color\]/i",
                "<font color=\\1>\\2</font>", $s);
            // [color=#ffcc99]Text[/color]
            $s = preg_replace("/\[color=(#[a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9])\]((\s|.)+?)\[\/color\]/i",
                "<font color=\\1>\\2</font>", $s);
            // [size=4]Text[/size]
            $s = preg_replace("/\[size=([1-7])\]((\s|.)+?)\[\/size\]/i",
                "<font size=\\1>\\2</font>", $s);
            // [font=Arial]Text[/font]
            $s = preg_replace("/\[font=([a-zA-Z ,]+)\]((\s|.)+?)\[\/font\]/i",
                "<font face=\"\\1\">\\2</font>", $s);
            // Quotes
            $s = format_quotes($s);
            // URLs
            // $s = format_local_urls($s);
            // Linebreaks
            $s = nl2br($s);
            // [pre]Preformatted[/pre]
            $s = preg_replace("/\[pre\]((\s|.)+?)\[\/pre\]/i", "<tt><nobr>\\1</nobr></tt>", $s);
            // [nfo]NFO-preformatted[/nfo]
            $s = preg_replace("/\[nfo\]((\s|.)+?)\[\/nfo\]/i", "<tt><nobr><font face='MS Linedraw' size=2 style='font-size: 10pt; line-height: " . "10pt'>\\1</font></nobr></tt>", $s);
            // Maintain spacing
            $s = str_replace("  ", " &nbsp;", $s);
            // //////////////////
            $s = preg_replace("#<(\s+?)?s(\s+?)?c(\s+?)?r(\s+?)?i(\s+?)?p(\s+?)?t#is", "&lt;script" , $s);
            $s = preg_replace("#<(\s+?)?/(\s+?)?s(\s+?)?c(\s+?)?r(\s+?)?i(\s+?)?p(\s+?)?t#is", "&lt;/script", $s);
            $s = preg_replace("/javascript/i" , "j&#097;v&#097;script", $s);
            $s = preg_replace("/alert/i" , "&#097;lert", $s);
            $s = preg_replace("/about:/i" , "&#097;bout:", $s);
            $s = preg_replace("/onmouseover/i", "&#111;nmouseover", $s);
            $s = preg_replace("/onclick/i" , "&#111;nclick", $s);
            $s = preg_replace("/onsubmit/i" , "&#111;nsubmit", $s);
            $s = preg_replace("/<body/i" , "&lt;body", $s);
            $s = preg_replace("/<html/i" , "&lt;html", $s);
            $s = preg_replace("/document\./i" , "&#100;ocument.", $s);
            // ///////
            $s = preg_replace_callback("/\[img\](http:\/\/[^\s'\"<>]+(\.(jpg|gif|png)))\[\/img\]/i", "scale", $s);
            $s = preg_replace_callback("/\[img=(http:\/\/[^\s'\"<>]+(\.(gif|jpg|png)))\]/i", "scale", $s);
            // [hr=xxx]/[hr=xxx%]/[hr=xxxpt]/[hr=xxxpx]
            $s = preg_replace("/\[hr(\=([0-9]{1,4})(%|px|pt)?)\]/i",
                "<hr align=center width=\"\\1\" />", $s);
            // [hr]
            $s = str_replace ("[hr]", "<hr>", $s);
            // [center]
            $s = preg_replace("/\[center\]((\s|.)+?)\[\/center\]/i", "<div align='center'><tt><nobr><font face='Verdana' size=2 style='font-size: 10pt; line-height: " . "10pt'>\\1</font></nobr></tt></div>", $s);
            // [Spoiler]TEXT[/Spoiler]
            $s = preg_replace("/\[spoiler\]((\s|.)+?)\[\/spoiler\]/", "<div class=\"smallfont\" align=\"center\">
                <small><b><blink>Click the button to show/hide Spoiler.</blink><br></b></small><input type=\"button\" value=\"Show\" style=\"width:75px;font-size:10px;margin:0px;padding:0px;\" onclick=\"if (this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display != '') { this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display = '';this.innerText = ''; this.value = 'Hide'; } else { this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display = 'none'; this.innerText = ''; this.value = 'Show'; }\">
                <div style=\"margin: 10px; padding: 10px; border: 1px inset;\" align=\"left\"><div style=\"display: none;\">\\1</div></div></div>", $s);
            // [s]Stroke[/s]
            $s = preg_replace("/\[s\]((\s|.)+?)\[\/s\]/", "<s>\\1</s>", $s);
            //[align=(center|left|right|justify)]text[/align]
            $s = preg_replace("/\[align=([a-zA-Z]+)\]((\s|.)+?)\[\/align\]/i","<div style=\"text-align:\\1\">\\2</div>", $s);
            //[mail]mail[/mail]
            $s = preg_replace("/\[mail\]((\s|.)+?)\[\/mail\]/i","<a href=\"mailto:\\1\" targe=\"_blank\">\\1</a>", $s);
            // bad words
            $badwords_pattern = "/\b(asshole|assshole|fuck|cunt|bastard|fcuk|fook|tosser|fcck|cnut|bollocks|fucker|cunty|arseholes|fuckwit|shithead|fuckface|motherfucker|cock|cocksucker|shag|whore|dickhead|prick|faggot|crack|serial|keygen|tit|cvnt|bar steward|piss|fanny|bitch|arse|fuckin|fucking|fuckface|knob head|fuckhead|knob end|fuck|cunt|twat|wanker|bastard|shit|fvck|hoe|fookin|fooking|fook|ass|ass wipe|ass wipes)\b/i";
            $badwords_replace = "<img src=pic/censored.png />";
            $s = preg_replace($badwords_pattern, $badwords_replace, $s);

            reset($smilies);
            while (list($code, $url) = each($smilies))
            $s = str_replace($code, "<img border=0 src=\"{$pic_base_url}smilies/{$url}\" alt=\"" . htmlspecialchars($code) . "\" />", $s);

            reset($privatesmilies);
            while (list($code, $url) = each($privatesmilies))
            $s = str_replace($code, "<img border=0 src=\"{$pic_base_url}smilies/{$url}\" />", $s);

            reset($customsmilies);
            while (list($code, $url) = each($customsmilies))
            $s = str_replace($code, "<img border=0 src=\"/pic/smilies/$url\" alt=\"" . htmlspecialchars($code) . "\" />", $s);
            return $s;
        }
        // === smilie function
        function get_smile()
        {
            global $CURUSER;
            return $CURUSER["smile_until"];
        }
// //////////bbcode function by putyn///////////////
function textbbcode($form,$text,$content="") {
?>
<script type="text/javascript">
	function winop()
  {
  windop = window.open("moresmiles.php?form=<?=$form?>&text=<?=$text?>","mywin","height=400,width=450,resizable=yes,scrollbars=yes");
  }

  function winop2()
  {
  windop = window.open("moresmilies_custom.php?form=<?=$form?>&text=<?=$text?>","mywin","height=400,width=450,resizable=yes,scrollbars=yes");
  }
	function wrap(v,r,e)
	{
		var r = r ? r : "";
		var v = v ? v : "";
		var e = e ? e : "";
		
		var obj = document.getElementById("<?=$text?>");
		
		if (document.selection)
		{
			var str = document.selection.createRange().text;
			obj.focus();
			var sel = document.selection.createRange();
			sel.text = "["+v+(e ? "="+e : "")+"]" + (r ? r : str) + "[/"+v+"]";
        }
			else 
		{
			var len = obj.value.length;
			var start = obj.selectionStart;
			var end = obj.selectionEnd;
			var sel = obj.value.substring(start, end);
			obj.value =  obj.value.substring(0,start) + "[" + v +(e ? "="+e : "")+"]" + (r ? r : sel) + "[/" + v + "]" + obj.value.substring(end,len);
			obj.selectionEnd = start + v.length+e.length+sel.length+r.length+v.length+5;
			
		}
		obj.focus();
	}
	function clink()
	{
		var linkTitle;
		var linkAddr;
		
		linkAddr = prompt("Please enter the full URL","http://");
		if(linkAddr && linkAddr != "http://")
		linkTitle = prompt("Please enter the title", " ");
		
	  if(linkAddr && linkTitle)
		wrap('url',linkTitle,linkAddr);
	  
	}
	function cimage()
	{
		var link;
		link = prompt("Please enter the full URL for your image\nOnly .png, .jpg, .gif images","http://");
		var re_text = /\.jpg|\.gif|\.png|\.jpeg/i;
		if(re_text.test(link) == false && link != "http://" && link) {
				alert("Image not allowed only .jpg .gif .png .jpeg");
				link = prompt("Please enter the full URL for your image\nOnly .png, .jpg, .gif images","http://");
				}
	  if(link != "http://" && link)
		wrap('img',link,'');
	  
	}
	function tag(v)
	{
		wrap(v,'','');
	}
	function mail()
	{
		var email = ""; 
		email = prompt("Plese enter the email addres"," ");
		var filter = /^[\w.-]+@([\w.-]+\.)+[a-z]{2,6}$/i;
		if (!filter.test(email) && email.length > 1) {
			alert("Please provide a valid email address");
			email = prompt("Plese enter the email addres"," ");
		}
		if(email.length > 1)
		wrap('mail',email,'');
	}
	function text(to)
	{
		var obj = document.getElementById("<?=$text?>");
		
		if (document.selection)
		{
			var str = document.selection.createRange().text;
			obj.focus();
			var sel = document.selection.createRange();
			sel.text = (to == 'up' ? str.toUpperCase() : str.toLowerCase())
        }
			else 
		{
			var len = obj.value.length;
			var start = obj.selectionStart;
			var end = obj.selectionEnd;
			var sel = obj.value.substring(start, end);
			obj.value =  obj.value.substring(0,start) + (to == 'up' ? sel.toUpperCase() : sel.toLowerCase()) + obj.value.substring(end,len);
		}
		obj.focus();
	
	}
	function fonts(w)
	{
		var fmin = 12; var fmax = 24;
		var obj = document.getElementById("<?=$text?>");
		var size = obj.style.fontSize;
		size = (parseInt(size));
			var nsize ;
		if(w == 'up' && (size+1 < fmax))
			nsize = (size+1)+"px";
		if(w == 'down' && (size-1 > fmin))
			nsize = (size-1)+"px";
		
		obj.style.fontSize = nsize;
		obj.focus();
	}
	function font(w,f)
	{
		if(w == 'color')
			f = "#"+f;
			
		var obj = document.getElementById("<?=$text?>");
		
		if (document.selection)
		{
			var str = document.selection.createRange().text;
			obj.focus();
			var sel = document.selection.createRange();
			sel.text = "["+w+"="+f +"]" + str + "[/"+w+"]";
        }
			else 
		{
			var len = obj.value.length;
			var start = obj.selectionStart;
			var end = obj.selectionEnd;
			var sel = obj.value.substring(start, end);
			obj.value =  obj.value.substring(0,start) + "[" + w +"="+f+"]" + sel + "[/" + w + "]" + obj.value.substring(end,len);
			obj.selectionEnd = start + w.length+(1+f.length)+sel.length+w.length+5;
		}
		if(w != "color")
		document.getElementById("font"+w).selectedIndex = 0;
		obj.focus();
	}
	function em(f)
	{
		var obj = document.getElementById("<?=$text?>");
		
		if (document.selection)
		{
			var str = document.selection.createRange().text;
			obj.focus();
			var sel = document.selection.createRange();
			sel.text = f;
        }
			else 
		{
			var len = obj.value.length;
			var start = obj.selectionStart;
			var end = obj.selectionEnd;
			var sel = obj.value.substring(start, end);
			obj.value =  obj.value.substring(0,start) +f+ obj.value.substring(end,len);
			obj.selectionEnd = start + f.length;
		}
			obj.focus();
	}	document.onclick= function () 	{		var obj = document.getElementById("color_pick");			if(obj.style.display == 'block')				colorpicker();	}
	document.onmousemove = MouseUpdate;
	var hX;
	var hY;
	
	function chover(obj,act)
	{
		var color = obj.style.backgroundColor;
		var obj2 = document.getElementById("hover_pick");
		
		if(act == "show")
		{
			obj2.style.left = hX+"px";
			obj2.style.top = hY+"px";
			obj2.style.backgroundColor = color;
			obj2.style.display = "block";
		}
		else 
			obj2.style.display = "none";
		
	}
	function colorpicker()
	{
		var obj = document.getElementById("color_pick");
		var s = obj.style.display;
		
		if(s == "block")
			obj.style.display = "none";
		else
		{
			obj.style.left = hX+"px";
			obj.style.top = hY+"px"; 
			obj.style.display = "block";
		}
	}
	//function to capture the mouse cords
	// http://www.howtocreate.co.uk/tutorials/javascript/eventinf
	function MouseUpdate(e) 
		{
			 var mouse = MouseXY(e);
			 hX = 5+mouse[0];
			 hY = 5+mouse[1];
		}

	function MouseXY(e) {
	  if( !e ) {
		if( window.event ) {
		  //Internet Explorer
		  e = window.event;
		} else {
		  //total failure, we have no way of referencing the event
		  return;
		}
	  }
	  if( typeof( e.pageX ) == 'number' ) {
		//most browsers
		var xcoord = e.pageX;
		var ycoord = e.pageY;
	  } else if( typeof( e.clientX ) == 'number' ) {
		//Internet Explorer and older browsers
		//other browsers provide this, but follow the pageX/Y branch
		var xcoord = e.clientX;
		var ycoord = e.clientY;
		var badOldBrowser = ( window.navigator.userAgent.indexOf( 'Opera' ) + 1 ) ||
		  ( window.ScriptEngine && ScriptEngine().indexOf( 'InScript' ) + 1 ) ||
		  ( navigator.vendor == 'KDE' );
		if( !badOldBrowser ) {
		  if( document.body && ( document.body.scrollLeft || document.body.scrollTop ) ) {
			//IE 4, 5 & 6 (in non-standards compliant mode)
			xcoord += document.body.scrollLeft;
			ycoord += document.body.scrollTop;
		  } else if( document.documentElement && ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) ) {
			//IE 6 (in standards compliant mode)
			xcoord += document.documentElement.scrollLeft;
			ycoord += document.documentElement.scrollTop;
		  }
		}
	  } else {
		//total failure, we have no way of obtaining the mouse coordinates
		return;
	  }
	  return [xcoord, ycoord];
	}
	</script>
<div id="hover_pick" style="width:25px; height:25px; position:absolute; border:1px solid #333333; display:none; z-index:20;"></div>
<table class="color_pick" id="color_pick" border="1" cellspacing="2" cellpadding="0" style="position:absolute; display:none;">
  <tr>
    <td onclick="font('color','000000');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#000000;"></td>
    <td onclick="font('color','000033');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#000033;"></td>
    <td onclick="font('color','000066');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#000066;"></td>
    <td onclick="font('color','000099');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#000099;"></td>
    <td onclick="font('color','0000CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#0000CC;"></td>
    <td onclick="font('color','0000FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#0000FF;"></td>
    <td onclick="font('color','003300');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#003300;"></td>
    <td onclick="font('color','003333');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#003333;"></td>
    <td onclick="font('color','003366');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#003366;"></td>
    <td onclick="font('color','003399');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#003399;"></td>
    <td onclick="font('color','0033CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#0033CC;"></td>
    <td onclick="font('color','0033FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#0033FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','006600');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#006600;"></td>
    <td onclick="font('color','006633');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#006633;"></td>
    <td onclick="font('color','006666');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#006666;"></td>
    <td onclick="font('color','006699');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#006699;"></td>
    <td onclick="font('color','0066CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#0066CC;"></td>
    <td onclick="font('color','0066FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#0066FF;"></td>
    <td onclick="font('color','009900');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#009900;"></td>
    <td onclick="font('color','009933');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#009933;"></td>
    <td onclick="font('color','009966');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#009966;"></td>
    <td onclick="font('color','009999');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#009999;"></td>
    <td onclick="font('color','0099CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#0099CC;"></td>
    <td onclick="font('color','0099FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#0099FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','00CC00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00CC00;"></td>
    <td onclick="font('color','00CC33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00CC33;"></td>
    <td onclick="font('color','00CC66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00CC66;"></td>
    <td onclick="font('color','00CC99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00CC99;"></td>
    <td onclick="font('color','00CCCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00CCCC;"></td>
    <td onclick="font('color','00CCFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00CCFF;"></td>
    <td onclick="font('color','00FF00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00FF00;"></td>
    <td onclick="font('color','00FF33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00FF33;"></td>
    <td onclick="font('color','00FF66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00FF66;"></td>
    <td onclick="font('color','00FF99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00FF99;"></td>
    <td onclick="font('color','00FFCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00FFCC;"></td>
    <td onclick="font('color','00FFFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#00FFFF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','330000');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#330000;"></td>
    <td onclick="font('color','330033');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#330033;"></td>
    <td onclick="font('color','330066');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#330066;"></td>
    <td onclick="font('color','330099');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#330099;"></td>
    <td onclick="font('color','3300CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#3300CC;"></td>
    <td onclick="font('color','3300FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#3300FF;"></td>
    <td onclick="font('color','333300');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#333300;"></td>
    <td onclick="font('color','333333');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#333333;"></td>
    <td onclick="font('color','333366');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#333366;"></td>
    <td onclick="font('color','333399');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#333399;"></td>
    <td onclick="font('color','3333CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#3333CC;"></td>
    <td onclick="font('color','3333FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#3333FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','336600');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#336600;"></td>
    <td onclick="font('color','336633');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#336633;"></td>
    <td onclick="font('color','336666');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#336666;"></td>
    <td onclick="font('color','336699');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#336699;"></td>
    <td onclick="font('color','3366CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#3366CC;"></td>
    <td onclick="font('color','3366FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#3366FF;"></td>
    <td onclick="font('color','339900');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#339900;"></td>
    <td onclick="font('color','339933');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#339933;"></td>
    <td onclick="font('color','339966');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#339966;"></td>
    <td onclick="font('color','339999');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#339999;"></td>
    <td onclick="font('color','3399CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#3399CC;"></td>
    <td onclick="font('color','3399FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#3399FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','33CC00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33CC00;"></td>
    <td onclick="font('color','33CC33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33CC33;"></td>
    <td onclick="font('color','33CC66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33CC66;"></td>
    <td onclick="font('color','33CC99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33CC99;"></td>
    <td onclick="font('color','33CCCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33CCCC;"></td>
    <td onclick="font('color','33CCFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33CCFF;"></td>
    <td onclick="font('color','33FF00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33FF00;"></td>
    <td onclick="font('color','33FF33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33FF33;"></td>
    <td onclick="font('color','33FF66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33FF66;"></td>
    <td onclick="font('color','33FF99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33FF99;"></td>
    <td onclick="font('color','33FFCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33FFCC;"></td>
    <td onclick="font('color','33FFFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#33FFFF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','660000');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#660000;"></td>
    <td onclick="font('color','660033');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#660033;"></td>
    <td onclick="font('color','660066');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#660066;"></td>
    <td onclick="font('color','660099');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#660099;"></td>
    <td onclick="font('color','6600CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#6600CC;"></td>
    <td onclick="font('color','6600FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#6600FF;"></td>
    <td onclick="font('color','663300');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#663300;"></td>
    <td onclick="font('color','663333');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#663333;"></td>
    <td onclick="font('color','663366');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#663366;"></td>
    <td onclick="font('color','663399');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#663399;"></td>
    <td onclick="font('color','6633CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#6633CC;"></td>
    <td onclick="font('color','6633FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#6633FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','666600');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#666600;"></td>
    <td onclick="font('color','666633');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#666633;"></td>
    <td onclick="font('color','666666');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#666666;"></td>
    <td onclick="font('color','666699');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#666699;"></td>
    <td onclick="font('color','6666CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#6666CC;"></td>
    <td onclick="font('color','6666FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#6666FF;"></td>
    <td onclick="font('color','669900');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#669900;"></td>
    <td onclick="font('color','669933');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#669933;"></td>
    <td onclick="font('color','669966');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#669966;"></td>
    <td onclick="font('color','669999');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#669999;"></td>
    <td onclick="font('color','6699CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#6699CC;"></td>
    <td onclick="font('color','6699FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#6699FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','66CC00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66CC00;"></td>
    <td onclick="font('color','66CC33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66CC33;"></td>
    <td onclick="font('color','66CC66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66CC66;"></td>
    <td onclick="font('color','66CC99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66CC99;"></td>
    <td onclick="font('color','66CCCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66CCCC;"></td>
    <td onclick="font('color','66CCFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66CCFF;"></td>
    <td onclick="font('color','66FF00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66FF00;"></td>
    <td onclick="font('color','66FF33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66FF33;"></td>
    <td onclick="font('color','66FF66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66FF66;"></td>
    <td onclick="font('color','66FF99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66FF99;"></td>
    <td onclick="font('color','66FFCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66FFCC;"></td>
    <td onclick="font('color','66FFFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#66FFFF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','990000');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#990000;"></td>
    <td onclick="font('color','990033');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#990033;"></td>
    <td onclick="font('color','990066');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#990066;"></td>
    <td onclick="font('color','990099');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#990099;"></td>
    <td onclick="font('color','9900CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#9900CC;"></td>
    <td onclick="font('color','9900FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#9900FF;"></td>
    <td onclick="font('color','993300');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#993300;"></td>
    <td onclick="font('color','993333');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#993333;"></td>
    <td onclick="font('color','993366');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#993366;"></td>
    <td onclick="font('color','993399');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#993399;"></td>
    <td onclick="font('color','9933CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#9933CC;"></td>
    <td onclick="font('color','9933FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#9933FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','996600');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#996600;"></td>
    <td onclick="font('color','996633');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#996633;"></td>
    <td onclick="font('color','996666');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#996666;"></td>
    <td onclick="font('color','996699');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#996699;"></td>
    <td onclick="font('color','9966CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#9966CC;"></td>
    <td onclick="font('color','9966FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#9966FF;"></td>
    <td onclick="font('color','999900');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#999900;"></td>
    <td onclick="font('color','999933');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#999933;"></td>
    <td onclick="font('color','999966');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#999966;"></td>
    <td onclick="font('color','999999');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#999999;"></td>
    <td onclick="font('color','9999CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#9999CC;"></td>
    <td onclick="font('color','9999FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#9999FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','99CC00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99CC00;"></td>
    <td onclick="font('color','99CC33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99CC33;"></td>
    <td onclick="font('color','99CC66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99CC66;"></td>
    <td onclick="font('color','99CC99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99CC99;"></td>
    <td onclick="font('color','99CCCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99CCCC;"></td>
    <td onclick="font('color','99CCFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99CCFF;"></td>
    <td onclick="font('color','99FF00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99FF00;"></td>
    <td onclick="font('color','99FF33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99FF33;"></td>
    <td onclick="font('color','99FF66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99FF66;"></td>
    <td onclick="font('color','99FF99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99FF99;"></td>
    <td onclick="font('color','99FFCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99FFCC;"></td>
    <td onclick="font('color','99FFFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#99FFFF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','CC0000');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC0000;"></td>
    <td onclick="font('color','CC0033');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC0033;"></td>
    <td onclick="font('color','CC0066');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC0066;"></td>
    <td onclick="font('color','CC0099');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC0099;"></td>
    <td onclick="font('color','CC00CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC00CC;"></td>
    <td onclick="font('color','CC00FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC00FF;"></td>
    <td onclick="font('color','CC3300');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC3300;"></td>
    <td onclick="font('color','CC3333');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC3333;"></td>
    <td onclick="font('color','CC3366');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC3366;"></td>
    <td onclick="font('color','CC3399');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC3399;"></td>
    <td onclick="font('color','CC33CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC33CC;"></td>
    <td onclick="font('color','CC33FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC33FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','CC6600');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC6600;"></td>
    <td onclick="font('color','CC6633');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC6633;"></td>
    <td onclick="font('color','CC6666');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC6666;"></td>
    <td onclick="font('color','CC6699');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC6699;"></td>
    <td onclick="font('color','CC66CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC66CC;"></td>
    <td onclick="font('color','CC66FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC66FF;"></td>
    <td onclick="font('color','CC9900');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC9900;"></td>
    <td onclick="font('color','CC9933');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC9933;"></td>
    <td onclick="font('color','CC9966');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC9966;"></td>
    <td onclick="font('color','CC9999');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC9999;"></td>
    <td onclick="font('color','CC99CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC99CC;"></td>
    <td onclick="font('color','CC99FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CC99FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','CCCC00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCCC00;"></td>
    <td onclick="font('color','CCCC33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCCC33;"></td>
    <td onclick="font('color','CCCC66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCCC66;"></td>
    <td onclick="font('color','CCCC99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCCC99;"></td>
    <td onclick="font('color','CCCCCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCCCCC;"></td>
    <td onclick="font('color','CCCCFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCCCFF;"></td>
    <td onclick="font('color','CCFF00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCFF00;"></td>
    <td onclick="font('color','CCFF33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCFF33;"></td>
    <td onclick="font('color','CCFF66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCFF66;"></td>
    <td onclick="font('color','CCFF99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCFF99;"></td>
    <td onclick="font('color','CCFFCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCFFCC;"></td>
    <td onclick="font('color','CCFFFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#CCFFFF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','FF0000');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF0000;"></td>
    <td onclick="font('color','FF0033');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF0033;"></td>
    <td onclick="font('color','FF0066');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF0066;"></td>
    <td onclick="font('color','FF0099');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF0099;"></td>
    <td onclick="font('color','FF00CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF00CC;"></td>
    <td onclick="font('color','FF00FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF00FF;"></td>
    <td onclick="font('color','FF3300');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF3300;"></td>
    <td onclick="font('color','FF3333');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF3333;"></td>
    <td onclick="font('color','FF3366');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF3366;"></td>
    <td onclick="font('color','FF3399');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF3399;"></td>
    <td onclick="font('color','FF33CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF33CC;"></td>
    <td onclick="font('color','FF33FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF33FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','FF6600');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF6600;"></td>
    <td onclick="font('color','FF6633');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF6633;"></td>
    <td onclick="font('color','FF6666');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF6666;"></td>
    <td onclick="font('color','FF6699');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF6699;"></td>
    <td onclick="font('color','FF66CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF66CC;"></td>
    <td onclick="font('color','FF66FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF66FF;"></td>
    <td onclick="font('color','FF9900');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF9900;"></td>
    <td onclick="font('color','FF9933');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF9933;"></td>
    <td onclick="font('color','FF9966');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF9966;"></td>
    <td onclick="font('color','FF9999');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF9999;"></td>
    <td onclick="font('color','FF99CC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF99CC;"></td>
    <td onclick="font('color','FF99FF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FF99FF;"></td>
  </tr>
  <tr>
    <td onclick="font('color','FFCC00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFCC00;"></td>
    <td onclick="font('color','FFCC33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFCC33;"></td>
    <td onclick="font('color','FFCC66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFCC66;"></td>
    <td onclick="font('color','FFCC99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFCC99;"></td>
    <td onclick="font('color','FFCCCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFCCCC;"></td>
    <td onclick="font('color','FFCCFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFCCFF;"></td>
    <td onclick="font('color','FFFF00');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFFF00;"></td>
    <td onclick="font('color','FFFF33');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFFF33;"></td>
    <td onclick="font('color','FFFF66');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFFF66;"></td>
    <td onclick="font('color','FFFF99');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFFF99;"></td>
    <td onclick="font('color','FFFFCC');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFFFCC;"></td>
    <td onclick="font('color','FFFFFF');colorpicker();" onmouseover="chover(this,'show');" onmouseout="chover(this,'back');" style="width:10px;height:10px;background:#FFFFFF;"></td>
  </tr>
</table>
<table cellpadding="5" cellspacing="0" align="center"  border="1" class="bb_holder">
  <tr>
    <td width="100%" style="background:#CCCCCC; padding:0" colspan="2">
    <div style="float:left;padding:4px 0px 0px 2px;"> 
        <img class="bb_icon" src="pic/bbcode/bold.png" onclick="tag('b')" title="Bold" alt="B" /> 
        <img class="bb_icon" src="pic/bbcode/italic.png" onclick="tag('i')" title="Italic" alt="I" /> 
        <img class="bb_icon" src="pic/bbcode/underline.png" onclick="tag('u')" title="Underline" alt="U" /> 
        <img class="bb_icon" src="pic/bbcode/strike.png" onclick="tag('s')" title="Strike" alt="S" /> 
        <img class="bb_icon" src="pic/bbcode/link.png" onclick="clink()" title="Link" alt="Link" /> 
        <img class="bb_icon" src="pic/bbcode/picture.png" onclick="cimage()" title="Add image" alt="Image"/> 
        <img class="bb_icon" src="pic/bbcode/colors.png" onclick="colorpicker();" title="Select Color" alt="Colors" /> 
        <img class="bb_icon" src="pic/bbcode/email.png" onclick="mail()" title="Add email" alt="Email" /> 
        <?php
            if (get_user_class() >= UC_MODERATOR) {
                ?>
        <img class="bb_icon" src="pic/bbcode/php.png" onclick="tag('php')" title="Add php" alt="Php" /> 
        <img class="bb_icon" src="pic/bbcode/sql.png" onclick="tag('sql')" title="Add sql" alt="Sql" />
        <img class="bb_icon" src="pic/bbcode/script.png" onclick="tag('html')" title="Add html" alt="Html" />
        <img class="bb_icon" src="pic/bbcode/modcom.png" onclick="tag('mcom')" title="Mod comment" alt="Mod comment" />
        <?php }
            ?>
   </div>
      <div style="float:right;padding:4px 2px 0px 0px;"> 
      	<img class="bb_icon" src="pic/bbcode/align_center.png" onclick="wrap('align','','center')" title="Align - center" alt="Center" /> 		        <img class="bb_icon" src="pic/bbcode/align_left.png" onclick="wrap('align','','left')" title="Align - left" alt="Left" /> 
        <img class="bb_icon" src="pic/bbcode/align_justify.png" onclick="wrap('align','','justify')" title="Align - justify" alt="justify" /> 		<img class="bb_icon" src="pic/bbcode/align_right.png" onclick="wrap('align','','right')" title="Align - right" alt="Right" /> 
      </div>
     </td>
  </tr>
  <tr>
    <td width="100%" style="background:#CCCCCC; padding:0;" colspan="2">
    <div style="float:left;padding:4px 0px 0px 2px;">
    	<select name="fontface" id="fontface"  class="bb_icon" onchange="font('face',this.value);" title="Font face">
          <option value="0">Font face</option>
          <option value="Arial" style="font-family: Arial;">Arial</option>
          <option value="Arial Black" style="font-family: Arial Black;">Arial Black</option>
          <option value="Comic Sans MS" style="font-family: Comic Sans MS;">Comic Sans MS</option>
          <option value="Courier New" style="font-family: Courier New;">Courier New</option>
          <option value="Franklin Gothic Medium" style="font-family: Franklin Gothic Medium;">Franklin Gothic Medium</option>
          <option value="Georgia" style="font-family: Georgia;">Georgia</option>
          <option value="Helvetica" style="font-family: Helvetica;">Helvetica</option>
          <option value="Impact" style="font-family: Impact;">Impact</option>
          <option value="Lucida Console" style="font-family: Lucida Console;">Lucida Console</option>
          <option value="Lucida Sans Unicode" style="font-family: Lucida Sans Unicode;">Lucida Sans Unicode</option>
          <option value="Microsoft Sans Serif" style="font-family: Microsoft Sans Serif;">Microsoft Sans Serif</option>
          <option value="Palatino Linotype" style="font-family: Palatino Linotype;">Palatino Linotype</option>
          <option value="Tahoma" style="font-family: Tahoma;">Tahoma</option>
          <option value="Times New Roman" style="font-family: Times New Roman;">Times New Roman</option>
          <option value="Trebuchet MS" style="font-family: Trebuchet MS;">Trebuchet MS</option>
          <option value="Verdana" style="font-family: Verdana;">Verdana</option>
          <option value="Symbol" style="font-family: Symbol;">Symbol</option>
        </select>
		<select name="fontsize" id="fontsize" class="bb_icon" style="padding-bottom:3px;" onchange="font('size',this.value);" title="Font size">
			<option value="0">Font size</option>
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
        </select>
        </div>
      <div style="float:right;padding:4px 2px 0px 0px;"> 
      	<img class="bb_icon" src="pic/bbcode/text_uppercase.png" onclick="text('up')" title="To Uppercase" alt="Up" /> 
        <img class="bb_icon" src="pic/bbcode/text_lowercase.png" onclick="text('low')" title="To Lowercase" alt="Low" /> 
        <img class="bb_icon" src="pic/bbcode/zoom_in.png" onclick="fonts('up')" title="Font size up" alt="S up" /> 
        <img class="bb_icon" src="pic/bbcode/zoom_out.png" onclick="fonts('down')" title="Font size up" alt="S down" />
     </div></td>
  </tr>
  <tr>
    <td><textarea id="<?=$text?>" name="<?=$text?>" style="width:530px; height:250px;font-size:12px;"><?=$content?></textarea></td>
	<td align="center" valign="top">
		<table width="0" cellpadding="2" border="1" class="em_holder" cellspacing="2">
	<tr>
      <td align="center"><a href="javascript:em(':-)');" ><img border="0" alt=" " src="pic/smilies/smile1.gif" width="18" height="18" /></a></td>
      <td align="center"><a href="javascript:em(':smile:');" ><img border="0" alt=" " src="pic/smilies/smile2.gif" width="18" height="18" /></a></td>
      <td align="center"><a href="javascript:em(':-D');" ><img border="0" alt=" " src="pic/smilies/grin.gif" width="18" height="18" /></a></td>
      <td align="center"><a href="javascript:em(':w00t:');" ><img border="0" alt=" " src="pic/smilies/w00t.gif" width="18" height="20" /></a></td>
    </tr>
    <tr>
      <td align="center"><a href="javascript:em(':-P');" ><img border="0" alt=" " src="pic/smilies/tongue.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(';-)');" ><img border="0" alt=" " src="pic/smilies/wink.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':-|');" ><img border="0" alt=" " src="pic/smilies/noexpression.gif" width="18" height="18" /></a></td>
      <td align="center"><a href="javascript:em(':-/');" ><img border="0" alt=" " src="pic/smilies/confused.gif" width="18" height="18" /></a></td>
    </tr>
    <tr>
      <td align="center"><a href="javascript:em(':-(');" ><img border="0" alt=" " src="pic/smilies/sad.gif" width="18" height="18" /></a></td>
      <td align="center"><a href="javascript:em(':baby:');" ><img border="0" alt=" " src="pic/smilies/baby.gif" width="20" height="22" /></a></td>
      <td align="center"><a href="javascript:em(':-O');" ><img border="0" alt=" " src="pic/smilies/ohmy.gif" width="18" height="18" /></a></td>
      <td align="center"><a href="javascript:em('|-)');" ><img border="0" alt=" " src="pic/smilies/sleeping.gif" width="20" height="27" /></a></td>
    </tr>
    <tr>
      <td align="center"><a href="javascript:em(':innocent:');" ><img border="0" alt=" " src="pic/smilies/innocent.gif" width="18" height="22" /></a></td>
      <td align="center"><a href="javascript:em(':unsure:');" ><img border="0" alt=" " src="pic/smilies/unsure.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':closedeyes:');" ><img border="0" alt=" " src="pic/smilies/closedeyes.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':cool:');" ><img border="0" alt=" " src="pic/smilies/cool2.gif" width="20" height="20" /></a></td>
    </tr>
    <tr>
      <td align="center"><a href="javascript:em(':thumbsdown:');" ><img border="0" alt=" " src="pic/smilies/thumbsdown.gif" width="27" height="18" /></a></td>
      <td align="center"><a href="javascript:em(':blush:');" ><img border="0" alt=" " src="pic/smilies/blush.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':yes:');" ><img border="0" alt=" " src="pic/smilies/yes.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':no:');" ><img border="0" alt=" " src="pic/smilies/no.gif" width="20" height="20" /></a></td>
    </tr>
    <tr>
      <td align="center"><a href="javascript:em(':love:');" ><img border="0" alt=" " src="pic/smilies/love.gif" width="19" height="19" /></a></td>
      <td align="center"><a href="javascript:em(':?:');" ><img border="0" alt=" " src="pic/smilies/question.gif" width="19" height="19" /></a></td>
      <td align="center"><a href="javascript:em(':!:');" ><img border="0" alt=" " src="pic/smilies/excl.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':idea:');" ><img border="0" alt=" " src="pic/smilies/idea.gif" width="19" height="19" /></a></td>
    </tr>
    <tr>
      <td align="center"><a href="javascript:em(':arrow:');" ><img border="0" alt=" " src="pic/smilies/arrow.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':arrow2:');" ><img border="0" alt=" " src="pic/smilies/arrow2.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':hmm:');" ><img border="0" alt=" " src="pic/smilies/hmm.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':hmmm:');" ><img border="0" alt=" " src="pic/smilies/hmmm.gif" width="25" height="23" /></a></td>
    </tr>
    <tr>
      <td align="center"><a href="javascript:em(':huh:');" ><img border="0" alt=" " src="pic/smilies/huh.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':rolleyes:');" ><img border="0" alt=" " src="pic/smilies/rolleyes.gif" width="20" height="20" /></a></td>
      <td align="center"><a href="javascript:em(':kiss:');" ><img border="0" alt=" " src="pic/smilies/kiss.gif" width="18" height="18" /></a></td>
      <td align="center"><a href="javascript:em(':shifty:');" ><img border="0" alt=" " src="pic/smilies/shifty.gif" width="20" height="20" /></a></td>
	<a href="javascript:winop();">More Smiles</a>
<?php
            if (get_smile() != '0000-00-00 00:00:00')
                echo'<br><a href="javascript:winop2();">Custom Smilies</a>';

            ?>
	</tr>
	</table>
	</td>
  </tr>
</table>
<?php
}


        function user_key_codes($key)
        {
            return "/\[$key\]/i";
        }

        function dynamic_user_vars($text)
        {
            global $CURUSER;
            // $zone = 0;        // GMT
            $zone = 3600 * -5; // EST
            $tim = time() + $zone;

            $cu = $CURUSER;
            // unset any variables ya dun want to display, or can't display
            unset($cu['old_password'], $cu['secret'], $cu['editsecret'], $cu['modcomment']);
            $bbkeys = array_keys($cu);
            $bbkeys[] = 'curdate';
            $bbkeys[] = 'curtime';
            $bbvals = array_values($cu);
            $bbvals[] = gmdate('F jS, Y', $tim);
            $bbvals[] = gmdate('g:i A', $tim);
            $bbkeys = array_map('user_key_codes', $bbkeys);
            return preg_replace($bbkeys, $bbvals, $text);
        }

        ?>